"Organization owning the build pipelines"
type cicd_Organization @model(key: ["uid", "source"]) {
  "Organization uid is unique within the source system, e.g Jenkins"
  uid: ID
  name: String
  description: String
  url: String
  source: String
}

"A definition of a build pipeline"
type cicd_Pipeline @model(key: ["uid", "organization"]) {
  "Pipeline uid is unique within the context of the organization"
  uid: ID
  name: String
  description: String
  url: String
  organization: cicd_Organization @reference(back: "pipelines")
}

"A single execution of a build pipeline"
type cicd_Build @model(key: ["uid", "pipeline"]) {
  "Build uid is unique within the context of the pipeline"
  uid: ID
  name: String
  number: Int
  createdAt: Timestamp
  startedAt: Timestamp
  endedAt: Timestamp
  status: cicd_BuildStatus
  url: String
  pipeline: cicd_Pipeline @reference(back: "builds")
}

"A step of a build"
type cicd_BuildStep @model(key: ["uid", "build"]) {
  "Build step uid is unique within the context of the build"
  uid: ID
  name: String
  command: String
  type: cicd_BuildStepType
  createdAt: Timestamp
  startedAt: Timestamp
  endedAt: Timestamp
  status: cicd_BuildStatus
  url: String
  build: cicd_Build @reference(back: "buildSteps")
}

type cicd_Deployment @model(key: ["uid", "source"]) {
  "Deployment uid is unique within the source system, e.g CodeDeploy"
  uid: ID
  application: compute_Application @reference(back: "deployments")
  build: cicd_Build @reference(back: "deployments")
  startedAt: Timestamp
  endedAt: Timestamp
  status: cicd_DeploymentStatus
  source: String
}

type cicd_Release @model(key: ["uid", "source"]) {
  "Release uid is unique within the source system, e.g Maven"
  uid: ID
  name: String
  htmlUrl: String
  description: String
  draft: Boolean
  createdAt: Timestamp
  releasedAt: Timestamp
  author: vcs_User @reference(back: "authoredReleases")
  source: String
}

"Build status"
type cicd_BuildStatus {
  category: cicd_BuildStatusCategory
  detail: String
}

enum cicd_BuildStatusCategory {
  Canceled
  Failed
  Queued
  Running
  Success
  Unknown
  Custom
}

"Build step type"
type cicd_BuildStepType {
  category: cicd_BuildStepTypeCategory
  detail: String
}

enum cicd_BuildStepTypeCategory {
  Script
  Manual
  Custom
}

"Deployment status"
type cicd_DeploymentStatus {
  category: cicd_DeploymentStatusCategory
  detail: String
}

enum cicd_DeploymentStatusCategory {
  Canceled
  Failed
  Queued
  Running
  RolledBack
  Success
}
